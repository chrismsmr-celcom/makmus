<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAKMUS — Mémoire & Vérité</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="top-nav">
        <div class="nav-left"><span id="live-clock">--:--:--</span></div>
        <div class="account-links">
            <div class="account-trigger" id="openModal">
                <span>MON COMPTE</span>
            </div>
        </div>
    </div>

    <header>
        <a href="index.html">
            <img src="https://i.postimg.cc/7ZWdGrQc/Screenshot_2025_12_24_21_32_24_removebg_preview.png" alt="MAKMUS">
        </a>
    </header>

    <nav class="main-nav">
        <ul>
            <li><a href="index.html" class="active">À LA UNE</a></li>
            <li><a href="#" onclick="loadCategory('world', 'RDC')">RDC</a></li>
            <li><a href="#" onclick="loadCategory('politics')">POLITIQUE</a></li>
            <li><a href="#" onclick="loadCategory('business')">ÉCONOMIE</a></li>
            <li><a href="#" onclick="loadCategory('sports')">SPORT</a></li>
            <li><a href="jeux.html" style="color: #a30000;">JEUX</a></li>
        </ul>
    </nav>

    <main class="page-container">
        <div class="date-bar" id="current-date">Chargement...</div>
        
        <div id="status-msg" style="display:none; text-align:center; padding:10px; background:#fff5f5; color:#c00; border:1px solid #c00; margin-bottom:20px;"></div>

        <section id="hero-section"></section>

        <div class="category-grid" id="news-grid">
            <p style="text-align:center; grid-column: 1/-1;">Mise à jour des dépêches en cours...</p>
        </div>
    </main>

    <script>
        // Mise à jour de l'heure
        function updateClock() {
            const now = new Date();
            document.getElementById('live-clock').textContent = now.toLocaleTimeString('fr-FR');
            document.getElementById('current-date').textContent = now.toLocaleDateString('fr-FR', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            }).toUpperCase();
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Fonction principale de chargement
        async function fetchArticles(category = 'top', query = '') {
            const hero = document.getElementById('hero-section');
            const grid = document.getElementById('news-grid');
            const status = document.getElementById('status-msg');

            try {
                status.style.display = "none";
                // Appel au backend (chemin relatif)
                let url = `/api/news?category=${category}`;
                if(query) url += `&q=${query}`;

                const response = await fetch(url);
                const data = await response.json();
                const articles = data.results || [];

                if (articles.length === 0) {
                    grid.innerHTML = "<p>Aucune information disponible pour cette rubrique.</p>";
                    return;
                }

                // Affichage du premier article (Hero)
                const first = articles[0];
                hero.innerHTML = `
                    <div class="hero-article" style="cursor:pointer;" onclick="window.open('${first.link}', '_blank')">
                        <h1 style="font-size: 2.8rem; line-height: 1.1; margin-bottom: 20px;">${first.title}</h1>
                        <div style="display: flex; gap: 20px; align-items: start;">
                            ${first.image_url ? `<img src="${first.image_url}" style="width: 65%; max-height: 450px; object-fit: cover;">` : ''}
                            <p style="font-size: 1.2rem; line-height: 1.5;">${first.description || "Détails à suivre dans nos prochaines éditions."}</p>
                        </div>
                        <hr style="margin: 30px 0; border: 0; border-top: 1px solid #000;">
                    </div>
                `;

                // Affichage de la suite dans la grille
                grid.innerHTML = "";
                articles.slice(1, 10).forEach(art => {
                    const card = document.createElement('div');
                    card.className = 'article-card';
                    card.style.cursor = "pointer";
                    card.onclick = () => window.open(art.link, '_blank');
                    card.innerHTML = `
                        ${art.image_url ? `<img src="${art.image_url}" style="width:100%; height:180px; object-fit:cover; margin-bottom:10px;">` : ''}
                        <h3 style="font-family:'Libre Baskerville'; font-size:1.1rem; border-top:1px solid #eee; pt:10px;">${art.title}</h3>
                    `;
                    grid.appendChild(card);
                });

            } catch (err) {
                status.style.display = "block";
                status.textContent = "Erreur de connexion avec le serveur MAKMUS.";
                console.error(err);
            }
        }

        // Charger une catégorie spécifique
        function loadCategory(cat, q = '') {
            fetchArticles(cat, q);
        }

        // Au chargement initial
        window.onload = () => fetchArticles('top');
    </script>
</body>
</html>

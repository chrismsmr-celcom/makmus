<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√©t√©o - Makmus</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
* { box-sizing: border-box; }

body { 
  margin: 0; 
  font-family: 'Inter', system-ui, sans-serif; 
  background: #f5f6f7;
  color: #111; 
}

header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  padding: 0.8rem 1.5rem; 
  background: #fff; 
  border-bottom: 1px solid #e5e5e5;
}

header .logo img { height: 36px; }
header nav ul { list-style: none; display: flex; gap: 1rem; margin: 0; padding: 0; }
header nav a { text-decoration: none; color: #111; font-size: 0.9rem; font-weight: 500; }

.weather-page { padding: 1.5rem 1rem 2rem; max-width: 1200px; margin: auto; }

#searchForm { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
#searchInput { flex: 1; padding: 0.7rem 0.8rem; border-radius: 10px; border: 1px solid #ccc; font-size: 0.9rem; }
#searchBtn { padding: 0.7rem 1.2rem; border: none; background: #111; color: #fff; border-radius: 10px; cursor: pointer; font-size: 0.9rem; }

#weather-container { display: flex; justify-content: center; margin-bottom: 2rem; }
.weather-card { background: #fff; padding: 1.5rem; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); width: 100%; max-width: 360px; text-align: center; }
.weather-card h3 { margin: 0 0 0.5rem; font-size: 1.2rem; }
.weather-card p { margin: 0.4rem 0; font-size: 0.9rem; color: #333; }
.weather-icon { width: 48px; height: 48px; margin-bottom: 0.5rem; }

.weather-page h2 { text-align: center; font-size: 1.2rem; margin-bottom: 1rem; }

#forecast-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
.forecast-card { background: #fff; padding: 1rem; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); text-align: center; font-size: 0.85rem; }
.forecast-card strong { display: block; margin-bottom: 0.3rem; font-weight: 600; }

.climate-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
.climate-card { background: #fff; padding: 1rem; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); text-align: center; font-size: 0.85rem; }
.climate-card strong { display: block; margin-bottom: 0.3rem; font-weight: 600; color: #111; }

#map { height: 380px; width: 100%; border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); overflow: hidden; }

@media (max-width: 768px) {
  header nav { display: none; }
  .weather-card { max-width: 100%; }
  #map { height: 300px; }
}
</style>
</head>
<body>

<header>
  <div class="logo"><img src="https://i.postimg.cc/7ZWdGrQc/Screenshot_2025_12_24_21_32_24_removebg_preview.png" alt="Makmus"></div>
  <nav>
    <ul>
      <li><a href="index.html">Accueil</a></li>
      <li><a href="meteo.html">M√©t√©o</a></li>
      <li><a href="politique.html">Politique</a></li>
      <li><a href="sport.html">Sport</a></li>
      <li><a href="musique.html">Musique</a></li>
      <li><a href="jeux.html">Jeux</a></li>
    </ul>
  </nav>
</header>

<div class="weather-page">
  <form id="searchForm">
    <input type="text" id="searchInput" placeholder="Chercher une ville ou un pays"/>
    <button type="submit" id="searchBtn">Rechercher</button>
  </form>

  <div id="weather-container"></div>

  <h2>Pr√©visions 7 jours</h2>
  <div id="forecast-container"></div>

  <h2>Donn√©es climatiques</h2>
  <div id="climate-container" class="climate-container"></div>

  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const weatherContainer = document.getElementById('weather-container');
const forecastContainer = document.getElementById('forecast-container');
const climateContainer = document.getElementById('climate-container');
const searchForm = document.getElementById('searchForm');
const searchInput = document.getElementById('searchInput');

// Carte Leaflet
const map = L.map('map').setView([-4.4419, 15.2663], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'¬© OpenStreetMap' }).addTo(map);

// Ic√¥nes m√©t√©o simples
function getWeatherIcon(code){
  if([0,1].includes(code)) return "‚òÄÔ∏è";
  if([2,3].includes(code)) return "‚õÖ";
  if([45].includes(code)) return "üå´Ô∏è";
  if([61,63,65,80].includes(code)) return "üåßÔ∏è";
  return "‚ùì";
}

async function fetchWeather(city){
  try {
    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`);
    const geoData = await geoRes.json();
    if(!geoData.results || !geoData.results.length) return alert("Ville non trouv√©e");

    const {latitude, longitude, name, country} = geoData.results[0];
    map.setView([latitude, longitude], 8);

    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode,precipitation_sum,windspeed_10m_max,sunrise,sunset&timezone=auto`);
    const weatherData = await weatherRes.json();

    renderWeatherCard({name, country, weatherData});
    renderForecast(weatherData.daily);
    renderClimate(weatherData);

  } catch(e){
    console.error(e);
    alert("Erreur lors de la r√©cup√©ration de la m√©t√©o.");
  }
}

function renderWeatherCard({name,country,weatherData}){
  weatherContainer.innerHTML = '';
  const card = document.createElement('div');
  card.className = 'weather-card';
  const weather = weatherData.current_weather;
  card.innerHTML = `
    <div class="weather-icon">${getWeatherIcon(weather.weathercode)}</div>
    <h3>${name}, ${country}</h3>
    <p>Temp√©rature actuelle : ${weather.temperature}¬∞C</p>
    <p>Vitesse du vent : ${weather.windspeed} km/h</p>
    <p>${weatherLabel(weather.weathercode)}</p>
  `;
  weatherContainer.appendChild(card);
}

function renderForecast(daily){
  forecastContainer.innerHTML = '';
  for(let i=0; i<daily.time.length; i++){
    const card = document.createElement('div');
    card.className = 'forecast-card';
    card.innerHTML = `
      <div class="weather-icon">${getWeatherIcon(daily.weathercode[i])}</div>
      <p><strong>${daily.time[i]}</strong></p>
      <p>Min: ${daily.temperature_2m_min[i]}¬∞C</p>
      <p>Max: ${daily.temperature_2m_max[i]}¬∞C</p>
      <p>Pluie: ${daily.precipitation_sum[i]} mm</p>
      <p>Vent: ${daily.windspeed_10m_max[i]} km/h</p>
      <p>üåÖ ${daily.sunrise[i].split('T')[1]} / üåá ${daily.sunset[i].split('T')[1]}</p>
    `;
    forecastContainer.appendChild(card);
  }
}

function renderClimate(weatherData){
  climateContainer.innerHTML = '';
  const current = weatherData.current_weather;
  const daily = weatherData.daily;

  const climateItems = [
    { label: "Temp√©rature max", value: `${daily.temperature_2m_max[0]}¬∞C` },
    { label: "Temp√©rature min", value: `${daily.temperature_2m_min[0]}¬∞C` },
    { label: "Vent max", value: `${daily.windspeed_10m_max[0]} km/h` },
    { label: "Pr√©cipitations", value: `${daily.precipitation_sum[0]} mm` },
    { label: "Lever du soleil", value: daily.sunrise[0].split('T')[1] },
    { label: "Coucher du soleil", value: daily.sunset[0].split('T')[1] },
    { label: "Conditions", value: weatherLabel(current.weathercode) }
  ];

  climateItems.forEach(item => {
    const card = document.createElement('div');
    card.className = 'climate-card';
    card.innerHTML = `<strong>${item.label}</strong><span>${item.value}</span>`;
    climateContainer.appendChild(card);
  });
}

function weatherLabel(code) {
  const map = {
    0: "Ciel d√©gag√©",
    1: "Plut√¥t d√©gag√©",
    2: "Partiellement nuageux",
    3: "Nuageux",
    45: "Brouillard",
    61: "Pluie l√©g√®re",
    63: "Pluie mod√©r√©e",
    65: "Forte pluie",
    80: "Averses"
  };
  return map[code] || "Conditions variables";
}

searchForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  const city = searchInput.value.trim();
  if(city) fetchWeather(city);
});

// GEOLOCALISATION AUTO
if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(pos => {
    const {latitude, longitude} = pos.coords;
    fetchWeatherByCoords(latitude, longitude);
  }, () => { fetchWeather("Kinshasa"); });
} else {
  fetchWeather("Kinshasa");
}

async function fetchWeatherByCoords(lat, lon){
  try {
    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode,precipitation_sum,windspeed_10m_max,sunrise,sunset&timezone=auto`);
    const weatherData = await weatherRes.json();
    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}`);
    const geoData = await geoRes.json();
    const name = geoData.results[0]?.name || "Localisation";
    const country = geoData.results[0]?.country || "";
    map.setView([lat, lon], 8);
    renderWeatherCard({name, country, weatherData});
    renderForecast(weatherData.daily);
    renderClimate(weatherData);
  } catch(e){
    console.error(e);
    alert("Erreur lors de la r√©cup√©ration de la m√©t√©o.");
  }
}
</script>
</body>
</html>
